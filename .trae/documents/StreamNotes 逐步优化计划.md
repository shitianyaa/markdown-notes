# StreamNotes 逐步优化计划

## 优化目标
提升代码质量、性能和用户体验，同时保持应用稳定性。

## 优化步骤

### 1. 代码质量改进 - 重构长函数
**目标**：将 App.tsx 中的长函数拆分为更小、职责单一的函数

- **1.1 重构 `handleCleanupAssets` 函数**
  - 拆分为 `scanFolderForOrphanedImages`、`confirmCleanup`、`deleteOrphanedImages` 等子函数
  - 改进代码结构和可读性

- **1.2 重构 `handleImageUpload` 函数**
  - 拆分为 `validateImage`、`saveImageToDisk`、`saveImageToMemory` 等子函数
  - 优化错误处理

- **1.3 重构 `handleOpenLocalFolder` 函数**
  - 拆分为 `checkBrowserSupport`、`requestDirectoryAccess`、`loadDirectoryContent` 等子函数
  - 改进用户反馈

### 2. 性能优化 - 改进存储策略
**目标**：解决 localStorage 容量限制问题

- **2.1 实现 IndexedDB 存储**
  - 创建 IndexedDB 工具类
  - 实现浏览器模式下的大文件存储
  - 添加存储容量监控

- **2.2 优化图片加载**
  - 实现图片懒加载
  - 添加图片大小限制
  - 优化图片缓存策略

### 3. 用户体验增强 - 改进视觉反馈
**目标**：添加操作反馈，提升用户体验

- **3.1 实现 Toast 通知系统**
  - 创建 Toast 组件
  - 添加操作成功/失败的通知
  - 实现通知的自动消失和手动关闭

- **3.2 改进加载状态显示**
  - 添加更明显的加载指示器
  - 优化加载动画
  - 添加加载进度提示

### 4. 功能增强 - 支持更多文件类型
**目标**：允许预览更多文件类型

- **4.1 添加文件类型图标**
  - 为不同文件类型添加图标
  - 优化文件列表显示

- **4.2 实现图片预览**
  - 支持点击图片文件查看大图
  - 添加图片缩放和旋转功能

### 5. 安全性改进 - 增强文件安全
**目标**：添加文件安全检查

- **5.1 实现文件大小限制**
  - 添加文件上传大小限制
  - 显示友好的错误提示

- **5.2 实现文件类型验证**
  - 限制可上传的文件类型
  - 添加文件类型检测

## 实施顺序
1. 重构长函数（代码质量）
2. 实现 Toast 通知（用户体验）
3. 改进存储策略（性能）
4. 支持更多文件类型（功能增强）
5. 增强文件安全（安全性）

## 预期效果
- 代码更易维护和扩展
- 应用性能提升，特别是在处理大量文件时
- 用户体验改善，操作反馈更明显
- 功能更丰富，支持更多文件类型
- 安全性增强，减少潜在风险

## 实施原则
- 每次只实现一个优化点，确保代码稳定
- 为每个优化点编写适当的测试
- 保持向后兼容性
- 优先考虑用户最需要的功能

## 技术栈
- React 18
- TypeScript
- Tailwind CSS
- IndexedDB API
- File System Access API

现在我将开始实施第一步：重构长函数。